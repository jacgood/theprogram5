name: Development Deployment

on:
  push:
    branches: [ dev ]
  workflow_dispatch:

jobs:
  test:
    name: Run Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Validate Docker files
        run: |
          # Check if Dockerfile exists and is valid
          if [ -f "build/docker/Dockerfile" ]; then
            echo "✓ Dockerfile found"
            # Basic syntax check
            docker run --rm -i hadolint/hadolint < build/docker/Dockerfile || echo "Dockerfile has warnings"
          else
            echo "✗ Dockerfile not found"
            exit 1
          fi
      
      - name: Validate Docker Compose files
        run: |
          # Check if docker-compose files exist
          if [ -f "deploy/docker-compose.yml" ]; then
            echo "✓ docker-compose.yml found"
            # Validate compose file syntax
            docker compose -f deploy/docker-compose.yml config > /dev/null
          else
            echo "✗ docker-compose.yml not found"
            exit 1
          fi
      
      - name: Check test scripts
        run: |
          chmod +x ./tests/*.sh
          echo "✓ Test scripts are executable"
          # Syntax check for shell scripts
          for script in ./tests/*.sh; do
            bash -n "$script" && echo "✓ $script syntax OK"
          done

  deploy:
    name: Deploy to Development
    runs-on: ubuntu-latest
    needs: test
    if: false  # Disabled - no dev environment configured
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Deployment notification
        run: |
          echo "⚠️ Development deployment skipped - no environment configured"